// Prisma Schema - SQLite Version for Quick Testing

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ========================================
// Models
// ========================================

model Table {
  id         String   @id @default(cuid())
  name       String   @unique
  gameType   String   @default("CASH") // CASH, TOURNAMENT, SIT_AND_GO
  smallBlind Float
  bigBlind   Float
  maxPlayers Int      @default(10)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  hands Hand[]

  @@index([name])
  @@index([gameType])
}

model Player {
  id            String   @id @default(cuid())
  name          String   @unique
  email         String?  @unique
  totalHands    Int      @default(0)
  totalWinnings Float    @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  playerInHands PlayerInHand[]
  actions       Action[]

  @@index([name])
  @@index([email])
}

model Hand {
  id         String   @id @default(cuid())
  tableId    String
  handNumber Int
  street     String   @default("PREFLOP") // PREFLOP, FLOP, TURN, RIVER, SHOWDOWN
  pot        Float    @default(0)
  rake       Float    @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  table   Table          @relation(fields: [tableId], references: [id], onDelete: Cascade)
  players PlayerInHand[]
  actions Action[]

  @@unique([tableId, handNumber])
  @@index([tableId])
  @@index([createdAt])
}

model PlayerInHand {
  id            String  @id @default(cuid())
  handId        String
  playerId      String
  position      String  // SB, BB, UTG, etc.
  startingChips Float
  endingChips   Float
  cards         String? // JSON: ["As", "Kh"]
  won           Float   @default(0)
  showedDown    Boolean @default(false)

  hand   Hand   @relation(fields: [handId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id])

  @@unique([handId, playerId])
  @@index([handId])
  @@index([playerId])
  @@index([position])
}

model Action {
  id         String   @id @default(cuid())
  handId     String
  playerId   String
  street     String   // PREFLOP, FLOP, TURN, RIVER, SHOWDOWN
  actionType String   // FOLD, CHECK, CALL, BET, RAISE, ALL_IN
  amount     Float    @default(0)
  sequence   Int
  timestamp  DateTime @default(now())

  hand   Hand   @relation(fields: [handId], references: [id], onDelete: Cascade)
  player Player @relation(fields: [playerId], references: [id])

  @@unique([handId, sequence])
  @@index([handId])
  @@index([playerId])
  @@index([street])
  @@index([timestamp])
}
